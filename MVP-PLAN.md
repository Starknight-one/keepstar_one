# MVP План — Сегодня + Завтра

## Цель
Рабочий демо: спросил → динамический дизайн → потыкал → спросил снова → обновилось.

---

## Фаза 0: Проверить что pipeline работает end-to-end (1 час)

Прежде чем что-то чинить — убедиться что базовый сценарий проходит.

### Тест 1: Поиск
```
Отправить: "покажи кроссовки"
Ожидание: появляется grid с карточками товаров
```

### Тест 2: Смена стиля
```
Отправить: "покажи с большими заголовками"
Ожидание: те же товары, но стиль изменился (freestyle)
```

### Тест 3: Новый поиск
```
Отправить: "а теперь покажи сумки"
Ожидание: новые товары заменили старые
```

### Тест 4: Навигация
```
Кликнуть на карточку → раскрывается деталь
Кликнуть Назад → возврат к grid
```

**Если всё работает** → переходи к Фазе 2.
**Если что-то сломано** → записывай ГДЕ именно ломается и ЧТО видишь в консоли/логах. Это Фаза 1.

---

## Фаза 1: Починить то что сломано (только если Фаза 0 не прошла)

### Частые проблемы и где искать:

| Симптом | Вероятная причина | Где смотреть |
|---------|-------------------|--------------|
| "покажи X" → ничего не происходит | Бэкенд не запущен или CORS | Консоль браузера (Network tab) |
| Запрос уходит, ответ пустой | Нет товаров в БД | `internal/adapters/postgres/` — проверить seed |
| Ответ приходит но виджеты не рисуются | Formation = null | Логи бэкенда — что вернул Agent2 |
| Agent1 ошибка | API key или модель | `.env` — ANTHROPIC_API_KEY, LLM_MODEL |
| Agent2 return nil | 0 products в state | Agent1 не записал данные — смотреть его логи |
| Freestyle не работает | Agent2 выбрал не тот тул | Логи Agent2 — какой tool_use пришёл от LLM |

### Ключевые логи для отладки:
- Бэкенд пишет в stdout: agent1 tool called, agent2 tool called, formation mode
- Фронтенд: Network tab → POST /api/v1/pipeline → смотреть Response body

---

## Фаза 2: Минимальные фиксы для убедительного демо (3-4 часа)

### Задача 2.1: Agent2 должен отвечать когда данных нет
**Файл:** `internal/usecases/agent2_execute.go` (строки 77-83)
**Сейчас:** если productCount==0 && serviceCount==0 → return nil
**Нужно:** вернуть текстовое сообщение типа "Ничего не найдено, попробуйте другой запрос"
**Сложность:** 15 минут

### Задача 2.2: Tool Isolation (если не сделано)
**Спека:** `ADW/specs/feature-agent-tool-isolation.md`
**Суть:** Agent1 видит только search_* тулы, Agent2 видит только render_* и freestyle
**Проверить:** в `agent1_execute.go` функция `getAgent1Tools()` — фильтрует ли по "search_"?
**Сложность:** уже есть спека, 30-60 минут

### Задача 2.3: Дать Agent2 больше контекста
**Файл:** `internal/usecases/agent2_execute.go`
**Сейчас получает:** productCount, fields, view_mode, user_request, data_change
**Добавить:** последние 2-3 сообщения из ConversationHistory (для контекста "что обсуждали")
**Зачем:** без этого Agent2 не понимает "сделай как раньше" или "покрупнее чем было"
**Сложность:** 30 минут

### Задача 2.4: Одно действие на фронте — убрать виджет
**Файл:** `FormationRenderer.jsx`
**Суть:** кнопка X на каждом виджете. При клике виджет убирается из formation локально.
**Зачем:** это самый простой способ показать "пользователь взаимодействует с дизайном"
**Не нужно:** отправлять на бэкенд (пока). Просто убрать из UI.
**Сложность:** 1 час

### Задача 2.5: Показать метрики скорости
**Уже есть в ответе:** agent1Ms, agent2Ms, totalMs
**Нужно:** показать маленьким текстом под formation: "Сгенерировано за 1.2с"
**Зачем:** для демо это впечатляет — "смотри как быстро"
**Сложность:** 20 минут

---

## Фаза 3: Полировка для продажи (2-3 часа, завтра)

### Задача 3.1: 2-3 красивых сценария
Подготовить конкретные запросы которые красиво работают:
- "покажи кроссовки Nike до 15000 рублей" → сетка
- "покажи только фотки крупно" → freestyle hero-стиль
- "а теперь компактным списком" → freestyle compact
- Клик → деталь → назад

### Задача 3.2: Базовая обработка ошибок на фронте
- Если бэкенд не отвечает → "Сервис недоступен" вместо зависания
- Если поиск пустой → красивое сообщение
- Retry кнопка

### Задача 3.3: Визуальная чистота
- Убрать debug-элементы если есть
- Проверить что тема marketplace выглядит прилично
- Мобильная адаптивность (хотя бы не ломается)

---

## Что НЕ делать сейчас

- Админка и PIM — после MVP
- Тесты — после MVP
- Лайки, корзина, сложные действия — после MVP
- Переезд на другую БД/LLM — после MVP
- Голосовой ввод — после MVP
- Стриминг ответов — после MVP
- Freestyle переделка (реально свободный формат) — после MVP

---

## Архитектурный чеклист (что уже ОК)

- [x] Pipeline: Agent1 → Agent2 → Formation
- [x] State: 6 контейнеров, zone-writes, deltas
- [x] Навигация: expand/back через fast paths
- [x] Рендеринг: Formation → Widget → Atom
- [x] LLM кэширование: conversation history
- [x] 4 шаблона: ProductCard, ServiceCard, ProductDetail, ServiceDetail
- [x] 5 стилей: product-hero, product-compact, product-detail, service-card, service-detail
- [x] Фронтенд: все рендереры работают

---

## Порядок работы с агентами (Claude Code)

Каждую задачу давай агенту как ОДИН конкретный запрос:

1. "Запусти бэкенд и фронтенд, отправь запрос 'покажи кроссовки', покажи что вернулось"
2. "В файле agent2_execute.go строки 77-83: вместо return nil верни текстовое сообщение"
3. "В FormationRenderer.jsx добавь кнопку X на каждый виджет, при клике скрывать виджет"

Маленькие, конкретные задачи. Не давай агенту "почини архитектуру" — давай "в файле X, строка Y, сделай Z".
