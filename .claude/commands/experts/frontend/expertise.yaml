# Frontend Implementation Expertise
# Keepstar - React Feature-Sliced Architecture

overview:
  description: "React SPA for AI-powered chat widget with dynamic widget rendering"
  architecture: "Feature-Sliced Design"
  framework: "React 19"
  bundler: "Vite 7"
  language: "JavaScript (JSX)"
  styling: "CSS"
  dev_port: 5173
  api_base: "http://localhost:8080/api/v1"

project_structure:
  root: "project/frontend/"
  entry_point: "src/main.jsx"

  layers:
    shared: "src/shared/"
    entities: "src/entities/"
    features: "src/features/"
    app: "src/app/"

layer_rules:
  description: "Direction: app → features → entities → shared"
  shared:
    imports: "Only external libraries"
    contains: "API client, hooks, UI components, utilities"
  entities:
    imports: "shared/"
    contains: "Business entities: atom, widget, message"
  features:
    imports: "shared/, entities/"
    contains: "Features: chat, overlay, canvas"
  app:
    imports: "Everything"
    contains: "Entry point, providers, global styles"

core_implementation:
  app:
    file: "src/App.jsx"
    purpose: "Root component with chat toggle"
    state:
      - "isChatOpen: boolean"
    components_used:
      - "ChatPanel from features/chat"

  shared:
    api:
      file: "src/shared/api/apiClient.js"
      purpose: "HTTP client for backend"
      status: "implemented"
      functions:
        sendChatMessage:
          signature: "sendChatMessage(message, sessionId = null)"
          endpoint: "POST /api/v1/chat"
          body: "{ message, sessionId? }"
          response: "{ sessionId, response, latencyMs }"
        getSession:
          signature: "getSession(sessionId)"
          endpoint: "GET /api/v1/session/{id}"
          response: "{ id, status, messages[], startedAt, lastActivityAt }"
          returns_null: "on 404 (session not found/expired)"
        getProducts:
          signature: "getProducts(tenantSlug, filters = {})"
          endpoint: "GET /api/v1/tenants/{slug}/products"
          filters: ["category", "brand", "search", "minPrice", "maxPrice", "limit", "offset"]
          response: "{ products: Product[], total: int }"
        getProduct:
          signature: "getProduct(tenantSlug, productId)"
          endpoint: "GET /api/v1/tenants/{slug}/products/{id}"
          response: "Product"
          returns_null: "on 404"

  entities:
    atom:
      directory: "src/entities/atom/"
      atomModel:
        file: "atomModel.js"
        exports: ["AtomType"]
      AtomRenderer:
        file: "AtomRenderer.jsx"
        purpose: "Renders atom by type"
        status: "stub"

    widget:
      directory: "src/entities/widget/"
      widgetModel:
        file: "widgetModel.js"
        exports: ["WidgetType", "FormationType"]
      WidgetRenderer:
        file: "WidgetRenderer.jsx"
        purpose: "Renders widget from atoms"
        status: "stub"

    message:
      directory: "src/entities/message/"
      messageModel:
        file: "messageModel.js"
        exports: ["MessageRole"]
        values: ["USER", "ASSISTANT"]
      MessageBubble:
        file: "MessageBubble.jsx"
        purpose: "Renders message with optional widgets"
        status: "implemented"

  features:
    chat:
      directory: "src/features/chat/"
      status: "implemented"

      chatModel:
        file: "chatModel.js"
        function: "createInitialChatState()"
        state: ["sessionId", "messages", "isLoading", "error"]

      useChatMessages:
        file: "useChatMessages.js"
        returns: ["sessionId", "messages", "isLoading", "error", "addMessage", "setMessages", "setLoading", "setError", "setSessionId"]
        status: "implemented"

      useChatSubmit:
        file: "useChatSubmit.js"
        params: ["sessionId", "addMessage", "setLoading", "setError", "setSessionId"]
        returns: ["submit"]
        features:
          - "Saves sessionId to localStorage on first message"
          - "Passes sessionId to API for session continuity"
        status: "implemented"

      ChatPanel:
        file: "ChatPanel.jsx"
        styles: "ChatPanel.css"
        purpose: "Main chat component"
        props: ["onClose"]
        features:
          - "Loads session history from localStorage on mount"
          - "Calls getSession() API to restore messages"
          - "Clears localStorage if session expired"
        status: "implemented"

      ChatHistory:
        file: "ChatHistory.jsx"
        purpose: "Renders message list"
        props: ["messages", "isLoading"]
        status: "implemented"

      ChatInput:
        file: "ChatInput.jsx"
        purpose: "Input with send button"
        props: ["onSubmit", "disabled"]
        status: "implemented"

    overlay:
      directory: "src/features/overlay/"
      useOverlayState:
        file: "useOverlayState.js"
        returns: ["isOpen", "open", "close", "toggle"]
      FullscreenOverlay:
        file: "FullscreenOverlay.jsx"
      status: "stub"

    canvas:
      directory: "src/features/canvas/"
      status: "placeholder for future"

    catalog:
      directory: "src/features/catalog/"
      status: "implemented"

      catalogModel:
        file: "catalogModel.js"
        function: "createInitialCatalogState()"
        state: ["products", "total", "isLoading", "error", "filters"]

      useCatalogProducts:
        file: "useCatalogProducts.js"
        params: ["tenantSlug"]
        returns: ["products", "total", "isLoading", "error", "filters", "loadProducts", "setFilters", "resetFilters"]
        status: "implemented"

      ProductGrid:
        file: "ProductGrid.jsx"
        styles: "ProductGrid.css"
        purpose: "Renders product grid using WidgetRenderer"
        props: ["products", "isLoading", "error"]
        features:
          - "Converts products to widget format"
          - "Uses WidgetRenderer for ProductCard"
          - "Loading and error states"
        status: "implemented"

session_persistence:
  storage: "localStorage"
  key: "chatSessionId"
  flow:
    on_mount:
      - "Check localStorage for chatSessionId"
      - "If found, call getSession(sessionId)"
      - "If session active, restore messages to state"
      - "If session expired/not found, clear localStorage"
    on_message:
      - "Send message with sessionId (if exists)"
      - "Save returned sessionId to localStorage"
      - "Update sessionId in state"

patterns:
  component_structure:
    - "Functional components with hooks"
    - "CSS files next to components"
    - "Props passed directly"

  hooks_pattern:
    - "use{Feature}{Action}.js"
    - "Return object with state and actions"

  naming:
    components: "PascalCase.jsx"
    hooks: "use{Name}.js"
    models: "{feature}Model.js"
    styles: "{Component}.css"

run_commands:
  install: "cd project/frontend && npm install"
  dev: "cd project/frontend && npm run dev"
  build: "cd project/frontend && npm run build"
  lint: "cd project/frontend && npm run lint"

migration_status:
  description: "Feature-sliced architecture with session persistence and catalog"
  completed:
    - "Migrate to features/chat/ChatPanel"
    - "Implement useChatMessages hook"
    - "Implement useChatSubmit hook"
    - "Connect to /api/v1/chat endpoint"
    - "Remove old components/Chat"
    - "Add getSession() API function"
    - "Add setMessages() to useChatMessages"
    - "Save sessionId to localStorage"
    - "Load chat history on mount"
    - "Add catalog API functions (getProducts, getProduct)"
    - "Implement catalog feature with ProductGrid"
    - "Add useCatalogProducts hook"
  next_steps:
    - "Connect ProductGrid to App"
    - "Add product detail view"
    - "Add canvas feature for widget display"
