# Frontend Entities Expertise
# Business entities - atom, widget, formation, message

overview:
  layer: "entities"
  path: "project/frontend/src/entities/"
  imports: "shared/"
  contains: "Business entities with model + renderer pattern"

entities:
  atom:
    path: "src/entities/atom/"
    files:
      - "atomModel.js - AtomType, AtomSubtype, AtomDisplay enums + legacy mapping"
      - "AtomRenderer.jsx - Renders by display (with legacy fallback)"
      - "Atom.css - Display-based styles"
    types: ["TEXT", "NUMBER", "IMAGE", "ICON", "VIDEO", "AUDIO"]
    subtypes:
      text: ["string", "date", "datetime", "url", "email", "phone"]
      number: ["int", "float", "currency", "percent", "rating"]
      image: ["url", "base64"]
      icon: ["name", "emoji", "svg"]
    displays:
      text: ["h1", "h2", "h3", "h4", "body-lg", "body", "body-sm", "caption", "badge-*", "tag-*"]
      number: ["price", "price-lg", "price-old", "rating", "rating-text", "rating-compact", "percent", "progress"]
      image: ["image", "image-cover", "avatar-*", "thumbnail", "gallery"]
      icon: ["icon", "icon-sm", "icon-lg"]
      interactive: ["button-primary", "button-secondary", "button-outline", "button-ghost"]
      layout: ["divider", "spacer"]
    legacy_mapping: "LEGACY_TYPE_TO_DISPLAY maps old types (price, badge, rating) to displays"
    status: "implemented"
    features:
      - "Display-based rendering: atom.display determines visual style"
      - "Legacy fallback: LEGACY_TYPE_TO_DISPLAY for old atom.type values"
      - "Type inference: inferDisplay(atom) when no display set"
      - "Subtype formatting: date/datetime formatting, currency display"
      - "Rating variants: full stars, text, compact"
      - "Image gallery: renders array of images"

  widget:
    path: "src/entities/widget/"
    files:
      - "widgetModel.js - WidgetType, WidgetTemplate, WidgetSize enums + FormationType"
      - "WidgetRenderer.jsx - Template-based or legacy rendering"
      - "Widget.css - Styles"
      - "templates/index.js - Template exports"
      - "templates/ProductCardTemplate.jsx - Slot-based product card"
      - "templates/ProductCardTemplate.css - Product card styles"
      - "templates/ProductDetailTemplate.jsx - Full product detail view"
      - "templates/ProductDetailTemplate.css - Product detail styles"
      - "templates/ServiceCardTemplate.jsx - Slot-based service card"
      - "templates/ServiceCardTemplate.css - Service card styles"
      - "templates/ServiceDetailTemplate.jsx - Full service detail view"
      - "templates/ServiceDetailTemplate.css - Service detail styles"
    types_legacy: ["PRODUCT_CARD", "PRODUCT_LIST", "COMPARISON_TABLE", "IMAGE_CAROUSEL", "TEXT_BLOCK", "QUICK_REPLIES"]
    template_enum: ["PRODUCT_CARD", "SERVICE_CARD"]
    templates_rendered: ["ProductCard", "ProductDetail", "ServiceCard", "ServiceDetail"]
    sizes: ["TINY", "SMALL", "MEDIUM", "LARGE"]
    status: "implemented"
    implementation_critical: |
      Templates contain internal helper components (AtomChip, SpecsTable, StockIndicator, etc.)
      that render atoms. These helpers MUST:
      1. Import and use AtomRenderer for all atom rendering
      2. Check atom.subtype (new) OR atom.type (legacy) for type-specific logic
      3. Check atom.display (new) OR atom.meta?.display (legacy) for display hints
      Never hardcode atom rendering logic - always delegate to AtomRenderer.
    components:
      - "ProductCardTemplate: renders atoms by slot (hero, badge, title, primary, price, secondary)"
      - "ProductDetailTemplate: full product view with all details, expandable sections"
      - "ServiceCardTemplate: renders service atoms (duration, provider, rating chips)"
      - "ServiceDetailTemplate: full service view with availability, attributes"
      - "TextBlock: atoms in text block (legacy)"
      - "QuickReplies: atoms as buttons (legacy)"
      - "DefaultWidget: fallback"
    slots:
      - "hero: main image/carousel"
      - "badge: overlay badge"
      - "title: product/service title"
      - "primary: main attributes (chips) - brand/category for products, duration/provider for services"
      - "price: price block"
      - "secondary: expandable details"
      - "description: full description (detail templates)"
      - "attributes: key-value attributes (detail templates)"

  formation:
    path: "src/entities/formation/"
    files:
      - "formationModel.js - FormationMode enum"
      - "FormationRenderer.jsx - Renders layout, accepts onWidgetClick prop"
      - "Formation.css - Styles"
      - "index.js - Exports"
    modes: ["GRID", "CAROUSEL", "SINGLE", "LIST"]
    status: "implemented"
    features:
      - "GRID: configurable cols (cols-2, cols-3)"
      - "CAROUSEL: horizontal scroll"
      - "SINGLE: one widget centered"
      - "LIST: vertical stack (default)"

  message:
    path: "src/entities/message/"
    files:
      - "messageModel.js - MessageRole enum"
      - "MessageBubble.jsx - Renders message (no CSS file)"
    roles: ["USER", "ASSISTANT"]
    status: "implemented"
    features:
      - "hideFormation prop to suppress widget/formation rendering"
      - "Legacy widgets: renders when widgets exist but no formation"
      - "New formation: renders FormationRenderer when formation exists"

pattern:
  - "Each entity: model.js + Renderer.jsx + .css (except message has no .css)"
  - "Renderers accept entity object as prop"
  - "Atoms render by display field, with legacy type fallback"

naming:
  models: "{entity}Model.js"
  renderers: "{Entity}Renderer.jsx or MessageBubble.jsx (message)"
  styles: "{Entity}.css (atom, widget, formation only)"
