# Backlog 2 — Путь к первой продаже

MVP почти готов. 6 шагов до продукта, который можно продавать.

**Что уже сделано:** каталог (PIM + enrichment + embeddings), дайджест (compact + one-time delivery), параллелизация поиска (×6), виджет (Shadow DOM), админка (MVP), тесты (4 слоя), логирование, instant navigation, prompt caching.

---

## Quick Win — Замеры контекста

**Что:** Подтвердить что сжатие дайджеста решило проблему раздутого контекста.
**Как:** 5-6 ходов в чате → посмотреть `input_tokens` в трейсах. Если total < 15k — закрыть.
**Время:** 30 минут.

---

## Шаг 1 — Пресеты + пользовательские кейсы

Три направления, нужно думать над каждым.

### 1. Больше пресетов — покрыть больше кейсов

Сейчас 7 пресетов (4 product + 3 service): grid, card, compact, detail. Покрывают базу: "покажи товары" → grid, "подробнее" → detail.

**Не покрыто:**
- [x] Сравнение ("сравни два крема") — `product_comparison` preset + ComparisonTemplate
- [ ] Рекомендации ("похожие" / "с этим покупают")
- [ ] Carousel (горизонтальный свайп — mode есть, пресет не использует)
- [ ] Промо/баннер (маркетинговый блок)
- [ ] Combined view (products + services вместе)
- [ ] Compact с картинкой (сейчас только name+price)

### 2. Гибкость флоу агент → бэкенд → фронт

Архитектура: Agent2 отдаёт JSON-инструкцию → бэкенд собирает Formation → фронт рендерит.

Сейчас агент уже может влиять на: какие поля показать, display стиль каждого поля (h1/h2/price-lg/badge...), размер виджета. Но не всё доезжает до экрана — фронт местами хардкодит своё (порядок слотов в JSX, размеры карточек в CSS, контейнер 600px).

Нужно прокачать: порядок слотов должен приходить в JSON с бэкенда и агент должен на это влиять. Размеры должны читаться из Formation, а не из хардкода. Фронт = дамб рендерер, не спорит с тем что пришло.

### 3. Сделать красивее

- Chat на тёмном фоне не видно
- Карточки мелковатые, контейнер зажат
- Нет action-кнопок (лайк, корзина, share)
- Нет fallback для битых картинок
- Mobile cramped

---

## Шаг 2 — Локальные провайдеры + стабильный поиск

**Что:** Перевести LLM, БД и эмбеддинги на локальных провайдеров. Прокачать поиск.

**Зачем:** Latency и стабильность. Сейчас всё в US — пользователь в РФ чувствует задержку. Поиск надо постоянно качать.

**Включает:**
- БД: локальный PostgreSQL (вместо Neon US)
- LLM: РФ провайдер или edge-инстанс
- Эмбеддинги: локальный провайдер (вместо OpenAI US)
- Проверить что поиск стабильно работает после переезда
- Возможно: tool train — 3 параллельных поиска по разным стратегиям для лучшего recall

**Текущий baseline (Railway US):** pipeline 2949ms, embedding 1084ms, DB 47-59ms.

---

## Шаг 3 — Тупой агентный механизм

**Что:** Agent1 тулой смотрит каталог → agent2 получает только сигнал "есть" / "нет". Без передачи данных.

**Зачем:** Минимум токенов, максимум точности. Agent1 не нужно знать ответ — только факт наличия. Тупой механизм = надёжный механизм.

**Как:** Упростить протокол между агентами. Tool result → binary signal. Agent2 рендерит из state, а не из того что передал agent1.

---

## Шаг 4 — Фиксы + прокачка админки

**Что:** Убрать мелкие проблемки, прокачать админку для удобного ведения каталога.

**Включает:**
- UX фиксы виджета
- Админка: удобство ведения каталога, визуальные улучшения
- Known issues из предыдущих апдейтов
- UPDATES.md — автоматизировать или хотя бы зафиксировать формат

---

## Шаг 5 — Маркетинговые триггеры

**Что:** Минимум 2 варианта триггеров, которые подталкивают к покупке прямо в чате.

**Зачем:** ×5 от стоимости токенов пакетом. Пакет на 5k сообщений = 5000 × $0.007 × 10 = ~$350. В рубли, минус налоги, но это уже бизнес.

**Варианты:**
- [ ] Триггер 1: ???
- [ ] Триггер 2: ???

---

## Шаг 6 — Massive Actions

**Что:** Написать ключевым людям на пилот. Плюс всем кому найду — 100, 1000 если получится.

**Логика:** Даже если не справлюсь с потоком заявок — справлюсь, найду как. А если нет — хотя бы кто-то точно попросит полную интеграцию и пакет на 1М сообщений.

---

*Последнее обновление: 2026-02-21 (+ comparison preset, lazy loading, overlay unlock)*
